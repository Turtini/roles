---
# Control: Password aging (login.defs)
# Enforces PASS_MAX_DAYS, PASS_MIN_DAYS, PASS_WARN_AGE

- name: "Control Metadata | password-aging"
  ansible.builtin.set_fact:
    turtini_control_meta:
      id: "password-aging"
      title: "Password aging policy is enforced via /etc/login.defs"
      stig:
        rules: []   # TODO: map to exact DISA STIG Rule IDs / Vuln IDs for RHEL 9
      severity: "medium"
      cci:
        - "TBD"
      nist:
        - "IA-5"
      rationale: >-
        Password aging reduces the window of exposure if credentials are compromised
        and supports baseline account hygiene requirements.
      check: >-
        Review /etc/login.defs and confirm PASS_MAX_DAYS, PASS_MIN_DAYS, and
        PASS_WARN_AGE meet the site policy.
      fix: >-
        Set PASS_MAX_DAYS, PASS_MIN_DAYS, and PASS_WARN_AGE in /etc/login.defs to
        values required by the site policy.
      implementation: >-
        This control audits current values and, when apply mode is enabled, updates
        /etc/login.defs to match role variables.
      notes:
        - "Applies primarily to new password changes; existing accounts may require chage remediation per site policy."
        - "Kept intentionally minimal and safe for early versions."
  tags: [controls, auth, password-aging, meta]

- name: "Password Aging | Metadata (verbose)"
  ansible.builtin.debug:
    var: turtini_control_meta
  when: turtini_stig_preflight_verbose | bool
  tags: [controls, auth, password-aging, meta]
